// WebcamJS v1.0.16 - http://github.com/jhuckaby/webcamjs - MIT Licensed
$Ready(function(){
!function(a,b){"function"==typeof define&&define.amd?define(["exports"],b):b("object"==typeof exports&&"string"!=typeof exports.nodeName?exports:a.commonJsStrict={})}(this,function(a){function g(a){if(a in c)return a;for(var d=a[0].toUpperCase()+a.slice(1),e=b.length;e--;)if(a=b[e]+d,a in c)return a}function h(a,b){a=a||{};for(var c in b)b[c]&&b[c].constructor&&b[c].constructor===Object?(a[c]=a[c]||{},h(a[c],b[c])):a[c]=b[c];return a}function i(a,b,c){var d;return function(){var e=this,f=arguments,g=function(){d=null,c||a.apply(e,f)},h=c&&!d;clearTimeout(d),d=setTimeout(g,b),h&&a.apply(e,f)}}function j(a){if("createEvent"in document){var b=document.createEvent("HTMLEvents");b.initEvent("change",!1,!0),a.dispatchEvent(b)}else a.fireEvent("onchange")}function k(a,b,c){if("string"==typeof b){var d=b;b={},b[d]=c}for(var e in b)a.style[e]=b[e]}function l(a,b){a.classList?a.classList.add(b):a.className+=" "+b}function m(a,b){a.classList?a.classList.remove(b):a.className=a.className.replace(b,"")}function n(a,b,c){var e,d=b||new Image;return d.src===a?e=new Promise(function(a,b){a(d)}):(e=new Promise(function(b,e){c&&"http"===a.substring(0,4).toLowerCase()&&d.setAttribute("crossOrigin","anonymous"),d.onload=function(){setTimeout(function(){b(d)},1)}}),d.src=a),d.style.opacity=0,e}function s(a,b){window.EXIF||b(0),EXIF.getData(a,function(){var a=EXIF.getTag(this,"Orientation");b(a)})}function t(a,b,c){var d=b.width,e=b.height,f=a.getContext("2d");switch(a.width=b.width,a.height=b.height,f.save(),c){case 2:f.translate(d,0),f.scale(-1,1);break;case 3:f.translate(d,e),f.rotate(180*Math.PI/180);break;case 4:f.translate(0,e),f.scale(1,-1);break;case 5:a.width=e,a.height=d,f.rotate(90*Math.PI/180),f.scale(1,-1);break;case 6:a.width=e,a.height=d,f.rotate(90*Math.PI/180),f.translate(0,-e);break;case 7:a.width=e,a.height=d,f.rotate(-90*Math.PI/180),f.translate(-d,e),f.scale(1,-1);break;case 8:a.width=e,a.height=d,f.translate(0,d),f.rotate(-90*Math.PI/180)}f.drawImage(b,0,0,d,e),f.restore()}function u(){var d,e,f,g,a=this,b="croppie-container",c=a.options.viewport.type?"cr-vp-"+a.options.viewport.type:null;a.options.useCanvas=a.options.enableOrientation||w.call(a),a.data={},a.elements={},d=a.elements.boundary=document.createElement("div"),f=a.elements.viewport=document.createElement("div"),e=a.elements.img=document.createElement("img"),g=a.elements.overlay=document.createElement("div"),a.options.useCanvas?(a.elements.canvas=document.createElement("canvas"),a.elements.preview=a.elements.canvas):a.elements.preview=a.elements.img,l(d,"cr-boundary"),k(d,{width:a.options.boundary.width+"px",height:a.options.boundary.height+"px"}),l(f,"cr-viewport"),c&&l(f,c),k(f,{width:a.options.viewport.width+"px",height:a.options.viewport.height+"px"}),f.setAttribute("tabindex",0),l(a.elements.preview,"cr-image"),l(g,"cr-overlay"),a.element.appendChild(d),d.appendChild(a.elements.preview),d.appendChild(f),d.appendChild(g),l(a.element,b),a.options.customClass&&l(a.element,a.options.customClass),C.call(this),a.options.enableZoom&&y.call(a)}function w(){return this.options.enableExif&&window.EXIF}function x(a){if(this.options.enableZoom){var b=this.elements.zoomer,c=Q(a,4);b.value=Math.max(b.min,Math.min(b.max,c))}}function y(){function d(){z.call(a,{value:parseFloat(c.value),origin:new r(a.elements.preview),viewportRect:a.elements.viewport.getBoundingClientRect(),transform:q.parse(a.elements.preview)})}function e(b){var c,e;c=b.wheelDelta?b.wheelDelta/1200:b.deltaY?b.deltaY/1060:b.detail?b.detail/-60:0,e=a._currentZoom+c,b.preventDefault(),x.call(a,e),d.call(a)}var a=this,b=a.elements.zoomerWrap=document.createElement("div"),c=a.elements.zoomer=document.createElement("input");l(b,"cr-slider-wrap"),l(c,"cr-slider"),c.type="range",c.step="0.0001",c.value=1,c.style.display=a.options.showZoomer?"":"none",a.element.appendChild(b),b.appendChild(c),a._currentZoom=1,a.elements.zoomer.addEventListener("input",d),a.elements.zoomer.addEventListener("change",d),a.options.mouseWheelZoom&&(a.elements.boundary.addEventListener("mousewheel",e),a.elements.boundary.addEventListener("DOMMouseScroll",e))}function z(a){function i(){var a={};a[e]=c.toString(),a[d]=g.toString(),k(b.elements.preview,a)}var b=this,c=a?a.transform:q.parse(b.elements.preview),f=a?a.viewportRect:b.elements.viewport.getBoundingClientRect(),g=a?a.origin:new r(b.elements.preview);if(b._currentZoom=a?a.value:b._currentZoom,c.scale=b._currentZoom,i(),b.options.enforceBoundary){var j=A.call(b,f),l=j.translate,m=j.origin;c.x>=l.maxX&&(g.x=m.minX,c.x=l.maxX),c.x<=l.minX&&(g.x=m.maxX,c.x=l.minX),c.y>=l.maxY&&(g.y=m.minY,c.y=l.maxY),c.y<=l.minY&&(g.y=m.maxY,c.y=l.minY)}i(),E.call(b),F.call(b)}function A(a){var b=this,c=b._currentZoom,d=a.width,e=a.height,f=b.options.boundary.width/2,g=b.options.boundary.height/2,h=b.elements.preview.getBoundingClientRect(),i=h.width,j=h.height,k=d/2,l=e/2,m=(k/c-f)*-1,n=m-(i*(1/c)-d*(1/c)),o=(l/c-g)*-1,p=o-(j*(1/c)-e*(1/c)),q=1/c*k,r=i*(1/c)-q,s=1/c*l,t=j*(1/c)-s;return{translate:{maxX:m,minX:n,maxY:o,minY:p},origin:{maxX:r,minX:q,maxY:t,minY:s}}}function B(){var a=this,b=a._currentZoom,c=a.elements.preview.getBoundingClientRect(),f=a.elements.viewport.getBoundingClientRect(),g=q.parse(a.elements.preview.style[e]),h=new r(a.elements.preview),i=f.top-c.top+f.height/2,j=f.left-c.left+f.width/2,l={},m={};l.y=i/b,l.x=j/b,m.y=(l.y-h.y)*(1-b),m.x=(l.x-h.x)*(1-b),g.x-=m.x,g.y-=m.y;var n={};n[d]=l.x+"px "+l.y+"px",n[e]=g.toString(),k(a.elements.preview,n)}function C(){function l(b,c){var d=a.elements.preview.getBoundingClientRect(),e=i.y+c,f=i.x+b;a.options.enforceBoundary?(h.top>d.top+c&&h.bottom<d.bottom+c&&(i.y=e),h.left>d.left+b&&h.right<d.right+b&&(i.x=f)):(i.y=e,i.x=f)}function m(b){function l(a){switch(a){case c:return[1,0];case d:return[0,1];case e:return[-1,0];case g:return[0,-1]}}var c=37,d=38,e=39,g=40;if(!b.shiftKey||b.keyCode!=d&&b.keyCode!=g){if(b.keyCode>=37&&b.keyCode<=40){b.preventDefault();var k=l(b.keyCode);i=q.parse(a.elements.preview),document.body.style[f]="none",h=a.elements.viewport.getBoundingClientRect(),n(k)}}else{var j=0;j=b.keyCode==d?parseFloat(a.elements.zoomer.value,10)+parseFloat(a.elements.zoomer.step,10):parseFloat(a.elements.zoomer.value,10)-parseFloat(a.elements.zoomer.step,10),a.setZoom(j)}}function n(b){var c=b[0],d=b[1],h={};l(c,d),h[e]=i.toString(),k(a.elements.preview,h),D.call(a),document.body.style[f]="",B.call(a),F.call(a),g=0}function o(e){if(e.preventDefault(),!b){if(b=!0,c=e.pageX,d=e.pageY,e.touches){var g=e.touches[0];c=g.pageX,d=g.pageY}i=q.parse(a.elements.preview),window.addEventListener("mousemove",p),window.addEventListener("touchmove",p),window.addEventListener("mouseup",r),window.addEventListener("touchend",r),document.body.style[f]="none",h=a.elements.viewport.getBoundingClientRect()}}function p(b){b.preventDefault();var f=b.pageX,h=b.pageY;if(b.touches){var m=b.touches[0];f=m.pageX,h=m.pageY}var n=f-c,o=h-d,p={};if("touchmove"==b.type&&b.touches.length>1){var q=b.touches[0],r=b.touches[1],s=Math.sqrt((q.pageX-r.pageX)*(q.pageX-r.pageX)+(q.pageY-r.pageY)*(q.pageY-r.pageY));g||(g=s/a._currentZoom);var t=s/g;return x.call(a,t),void j(a.elements.zoomer)}l(n,o),p[e]=i.toString(),k(a.elements.preview,p),D.call(a),d=h,c=f}function r(){b=!1,window.removeEventListener("mousemove",p),window.removeEventListener("touchmove",p),window.removeEventListener("mouseup",r),window.removeEventListener("touchend",r),document.body.style[f]="",B.call(a),F.call(a),g=0}var c,d,g,h,i,a=this,b=!1;a.elements.overlay.addEventListener("mousedown",o),a.elements.viewport.addEventListener("keydown",m),a.elements.overlay.addEventListener("touchstart",o)}function D(){var a=this,b=a.elements.boundary.getBoundingClientRect(),c=a.elements.preview.getBoundingClientRect();k(a.elements.overlay,{width:c.width+"px",height:c.height+"px",top:c.top-b.top+"px",left:c.left-b.left+"px"})}function F(){var c,a=this,b=a.get();if(G.call(a))if(a.options.update.call(a,b),a.$)a.$(a.element).trigger("update",b);else{var c;window.CustomEvent?c=new CustomEvent("update",{detail:b}):(c=document.createEvent("CustomEvent"),c.initCustomEvent("update",!0,!0,b)),a.element.dispatchEvent(c)}}function G(){return this.elements.preview.offsetHeight>0&&this.elements.preview.offsetWidth>0}function H(){var o,p,s,t,u,a=this,b=0,c=1.5,f=1,g={},h=a.elements.preview,i=a.elements.zoomer,l=new q(0,0,f),m=new r,n=G.call(a);if(n&&!a.data.bound){if(a.data.bound=!0,g[e]=l.toString(),g[d]=m.toString(),g.opacity=1,k(h,g),o=h.getBoundingClientRect(),p=a.elements.viewport.getBoundingClientRect(),s=a.elements.boundary.getBoundingClientRect(),a._originalImageWidth=o.width,a._originalImageHeight=o.height,a.options.enableZoom){a.options.enforceBoundary&&(t=p.width/o.width,u=p.height/o.height,b=Math.max(t,u)),b>=c&&(c=b+1),i.min=Q(b,4),i.max=Q(c,4);var v=Math.max(s.width/o.width,s.height/o.height);f=null!==a.data.boundZoom?a.data.boundZoom:v,x.call(a,f),j(i)}else a._currentZoom=f;l.scale=a._currentZoom,g[e]=l.toString(),k(h,g),a.data.points.length?I.call(a,a.data.points):J.call(a),B.call(a),D.call(a)}}function I(a){if(4!=a.length)throw"Croppie - Invalid number of points supplied: "+a;var b=this,c=a[2]-a[0],f=b.elements.viewport.getBoundingClientRect(),g=b.elements.boundary.getBoundingClientRect(),h={left:f.left-g.left,top:f.top-g.top},i=f.width/c,j=a[1],l=a[0],m=-1*a[1]+h.top,n=-1*a[0]+h.left,o={};o[d]=l+"px "+j+"px",o[e]=new q(n,m,i).toString(),k(b.elements.preview,o),x.call(b,i),b._currentZoom=i}function J(){var a=this,b=a.elements.preview.getBoundingClientRect(),c=a.elements.viewport.getBoundingClientRect(),d=a.elements.boundary.getBoundingClientRect(),f=c.left-d.left,g=c.top-d.top,h=f-(b.width-c.width)/2,i=g-(b.height-c.height)/2,j=new q(h,i,a._currentZoom);k(a.elements.preview,e,j.toString())}function K(a){var b=this,c=b.elements.canvas,d=b.elements.img,e=c.getContext("2d"),f=w.call(b),a=b.options.enableOrientation&&a;e.clearRect(0,0,c.width,c.height),c.width=d.width,c.height=d.height,f?s(d,function(b){t(c,d,parseInt(b)),a&&t(c,d,a)}):a&&t(c,d,a)}function L(a){var b=a.points,c=b[0],d=b[1],e=b[2]-b[0],f=b[3]-b[1],g=a.circle,h=document.createElement("canvas"),i=h.getContext("2d"),j=e,k=f;return a.outputWidth&&a.outputHeight&&(j=a.outputWidth,k=a.outputHeight),h.width=j,h.height=k,a.backgroundColor&&(i.fillStyle=a.backgroundColor,i.fillRect(0,0,j,k)),i.drawImage(this.elements.preview,c,d,e,f,0,0,j,k),g&&(i.fillStyle="#fff",i.globalCompositeOperation="destination-in",i.beginPath(),i.arc(j/2,k/2,j/2,0,2*Math.PI,!0),i.closePath(),i.fill()),h}function M(a){var b=a.points,c=document.createElement("div"),d=document.createElement("img"),e=b[2]-b[0],f=b[3]-b[1];return l(c,"croppie-result"),c.appendChild(d),k(d,{left:-1*b[0]+"px",top:-1*b[1]+"px"}),d.src=a.url,k(c,{width:e+"px",height:f+"px"}),c}function N(a){return L.call(this,a).toDataURL(a.format,a.quality)}function O(a){var b=this;return new Promise(function(c,d){L.call(b,a).toBlob(function(a){c(a)},a.format,a.quality)})}function P(a,b){var d,c=this,e=[],f=null;if("string"==typeof a)d=a,a={};else if(Array.isArray(a))e=a.slice();else{if("undefined"==typeof a&&c.data.url)return H.call(c),F.call(c),null;d=a.url,e=a.points||[],f="undefined"==typeof a.zoom?null:a.zoom}c.data.bound=!1,c.data.url=d||c.data.url,c.data.points=(e||c.data.points).map(function(a){return parseFloat(a)}),c.data.boundZoom=f;var g=n(d,c.elements.img,c.options.useCanvas);return g.then(function(){c.options.useCanvas&&(c.elements.img.exifdata=null,K.call(c,a.orientation||1)),H.call(c),F.call(c),b&&b()}),g}function Q(a,b){return parseFloat(a).toFixed(b||0)}function R(){var a=this,b=a.elements.preview.getBoundingClientRect(),c=a.elements.viewport.getBoundingClientRect(),d=c.left-b.left,e=c.top-b.top,f=(c.width-a.elements.viewport.offsetWidth)/2,g=(c.height-a.elements.viewport.offsetHeight)/2,h=d+a.elements.viewport.offsetWidth+f,i=e+a.elements.viewport.offsetHeight+g,j=a._currentZoom;(j===1/0||isNaN(j))&&(j=1);var k=a.options.enforceBoundary?0:Number.NEGATIVE_INFINITY;return d=Math.max(k,d/j),e=Math.max(k,e/j),h=Math.max(k,h/j),i=Math.max(k,i/j),{points:[Q(d),Q(e),Q(h),Q(i)],zoom:j}}function U(a){var n,b=this,c=R.call(b),d=h(S,h({},a)),e="string"==typeof a?a:d.type||"base64",f=d.size,g=d.format,i=d.quality,j=d.backgroundColor,k="boolean"==typeof d.circle?d.circle:"circle"===b.options.viewport.type,l=b.elements.viewport.getBoundingClientRect(),m=l.width/l.height;return"viewport"===f?(c.outputWidth=l.width,c.outputHeight=l.height):"object"==typeof f&&(f.width&&f.height?(c.outputWidth=f.width,c.outputHeight=f.height):f.width?(c.outputWidth=f.width,c.outputHeight=f.width/m):f.height&&(c.outputWidth=f.height*m,c.outputHeight=f.height)),T.indexOf(g)>-1&&(c.format="image/"+g,c.quality=i),c.circle=k,c.url=b.data.url,c.backgroundColor=j,n=new Promise(function(a,d){switch(e.toLowerCase()){case"rawcanvas":a(L.call(b,c));case"canvas":case"base64":a(N.call(b,c));break;case"blob":O.call(b,c).then(a);break;default:a(M.call(b,c))}})}function V(){H.call(this)}function W(a){if(!this.options.useCanvas)throw"Croppie: Cannot rotate without enableOrientation";var b=this,c=b.elements.canvas,e=(b.elements.img,document.createElement("canvas")),f=1;e.width=c.width,e.height=c.height;var g=e.getContext("2d");g.drawImage(c,0,0),90!==a&&a!==-270||(f=6),a!==-90&&270!==a||(f=8),180!==a&&a!==-180||(f=3),t(c,e,f),z.call(b)}function X(){var a=this;a.element.removeChild(a.elements.boundary),m(a.element,"croppie-container"),a.options.enableZoom&&a.element.removeChild(a.elements.zoomerWrap),delete a.elements}function Z(a,b){if(this.element=a,this.options=h(h({},Z.defaults),b),u.call(this),this.options.url){var c={url:this.options.url,points:this.options.points};delete this.options.url,delete this.options.points,P.call(this,c)}}"function"!=typeof Promise&&!function(a){function b(a,b){return function(){a.apply(b,arguments)}}function c(a){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof a)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],i(a,b(e,this),b(f,this))}function d(a){var b=this;return null===this._state?void this._deferreds.push(a):void k(function(){var c=b._state?a.onFulfilled:a.onRejected;if(null===c)return void(b._state?a.resolve:a.reject)(b._value);var d;try{d=c(b._value)}catch(b){return void a.reject(b)}a.resolve(d)})}function e(a){try{if(a===this)throw new TypeError("A promise cannot be resolved with itself.");if(a&&("object"==typeof a||"function"==typeof a)){var c=a.then;if("function"==typeof c)return void i(b(c,a),b(e,this),b(f,this))}this._state=!0,this._value=a,g.call(this)}catch(a){f.call(this,a)}}function f(a){this._state=!1,this._value=a,g.call(this)}function g(){for(var a=0,b=this._deferreds.length;b>a;a++)d.call(this,this._deferreds[a]);this._deferreds=null}function h(a,b,c,d){this.onFulfilled="function"==typeof a?a:null,this.onRejected="function"==typeof b?b:null,this.resolve=c,this.reject=d}function i(a,b,c){var d=!1;try{a(function(a){d||(d=!0,b(a))},function(a){d||(d=!0,c(a))})}catch(a){if(d)return;d=!0,c(a)}}var j=setTimeout,k="function"==typeof setImmediate&&setImmediate||function(a){j(a,1)},l=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)};c.prototype.catch=function(a){return this.then(null,a)},c.prototype.then=function(a,b){var e=this;return new c(function(c,f){d.call(e,new h(a,b,c,f))})},c.all=function(){var a=Array.prototype.slice.call(1===arguments.length&&l(arguments[0])?arguments[0]:arguments);return new c(function(b,c){function d(f,g){try{if(g&&("object"==typeof g||"function"==typeof g)){var h=g.then;if("function"==typeof h)return void h.call(g,function(a){d(f,a)},c)}a[f]=g,0===--e&&b(a)}catch(a){c(a)}}if(0===a.length)return b([]);for(var e=a.length,f=0;f<a.length;f++)d(f,a[f])})},c.resolve=function(a){return a&&"object"==typeof a&&a.constructor===c?a:new c(function(b){b(a)})},c.reject=function(a){return new c(function(b,c){c(a)})},c.race=function(a){return new c(function(b,c){for(var d=0,e=a.length;e>d;d++)a[d].then(b,c)})},c._setImmediateFn=function(a){k=a},"undefined"!=typeof module&&module.exports?module.exports=c:a.Promise||(a.Promise=c)}(this),"function"!=typeof window.CustomEvent&&!function(){function a(a,b){b=b||{bubbles:!1,cancelable:!1,detail:void 0};var c=document.createEvent("CustomEvent");return c.initCustomEvent(a,b.bubbles,b.cancelable,b.detail),c}a.prototype=window.Event.prototype,window.CustomEvent=a}(),HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(a,b,c){for(var d=atob(this.toDataURL(b,c).split(",")[1]),e=d.length,f=new Uint8Array(e),g=0;g<e;g++)f[g]=d.charCodeAt(g);a(new Blob([f],{type:b||"image/png"}))}});var d,e,f,b=["Webkit","Moz","ms"],c=document.createElement("div").style;e=g("transform"),d=g("transformOrigin"),f=g("userSelect");var o="translate3d",p=", 0px",q=function(a,b,c){this.x=parseFloat(a),this.y=parseFloat(b),this.scale=parseFloat(c)};q.parse=function(a){return a.style?q.parse(a.style[e]):a.indexOf("matrix")>-1||a.indexOf("none")>-1?q.fromMatrix(a):q.fromString(a)},q.fromMatrix=function(a){var b=a.substring(7).split(",");return b.length&&"none"!==a||(b=[1,0,0,1,0,0]),new q(parseInt(b[4],10),parseInt(b[5],10),parseFloat(b[0]))},q.fromString=function(a){var b=a.split(") "),c=b[0].substring(o.length+1).split(","),d=b.length>1?b[1].substring(6):1,e=c.length>1?c[0]:0,f=c.length>1?c[1]:0;return new q(e,f,d)},q.prototype.toString=function(){return o+"("+this.x+"px, "+this.y+"px"+p+") scale("+this.scale+")"};var r=function(a){if(!a||!a.style[d])return this.x=0,void(this.y=0);var b=a.style[d].split(" ");this.x=parseFloat(b[0]),this.y=parseFloat(b[1])};r.prototype.toString=function(){return this.x+"px "+this.y+"px"};var E=i(D,500),S={type:"canvas",format:"png",quality:1},T=["jpeg","webp","png"];if(window.jQuery){var Y=window.jQuery;Y.fn.croppie=function(a){var b=typeof a;if("string"===b){var c=Array.prototype.slice.call(arguments,1),d=Y(this).data("croppie");return"get"===a?d.get():"result"===a?d.result.apply(d,c):"bind"===a?d.bind.apply(d,c):this.each(function(){var b=Y(this).data("croppie");if(b){var d=b[a];if(!Y.isFunction(d))throw"Croppie "+a+" method not found";d.apply(b,c),"destroy"===a&&Y(this).removeData("croppie")}})}return this.each(function(){var b=new Z(this,a);b.$=Y,Y(this).data("croppie",b)})}}Z.defaults={viewport:{width:100,height:100,type:"square"},boundary:{width:300,height:300},orientationControls:{enabled:!0,leftClass:"",rightClass:""},customClass:"",showZoomer:!0,enableZoom:!0,mouseWheelZoom:!0,enableExif:!1,enforceBoundary:!0,enableOrientation:!1,update:function(){}},h(Z.prototype,{bind:function(a,b){return P.call(this,a,b)},get:function(){return R.call(this)},result:function(a){return U.call(this,a)},refresh:function(){return V.call(this)},setZoom:function(a){x.call(this,a),j(this.elements.zoomer)},rotate:function(a){W.call(this,a)},destroy:function(){return X.call(this)}}),a.Croppie=window.Croppie=Z,"object"==typeof module&&module.exports&&(module.exports=Z)});
(function(e){var t;function a(){var e=Error.apply(this,arguments);e.name=this.name="FlashError";this.stack=e.stack;this.message=e.message}function s(){var e=Error.apply(this,arguments);e.name=this.name="WebcamError";this.stack=e.stack;this.message=e.message}IntermediateInheritor=function(){};IntermediateInheritor.prototype=Error.prototype;a.prototype=new IntermediateInheritor;s.prototype=new IntermediateInheritor;var Webcam={version:"1.0.16",protocol:location.protocol.match(/https/i)?"https":"http",loaded:false,live:false,userMedia:true,params:{width:0,height:0,dest_width:0,dest_height:0,image_format:"jpeg",jpeg_quality:90,enable_flash:true,force_flash:false,flip_horiz:false,fps:30,upload_name:"webcam",constraints:null,swfURL:"",flashNotDetectedText:"ERROR: No Adobe Flash Player detected.  Webcam.js relies on Flash for browsers that do not support getUserMedia (like yours).",noInterfaceFoundText:"No supported webcam interface found.",unfreeze_snap:true},errors:{FlashError:a,WebcamError:s},hooks:{},init:function(){var t=this;this.mediaDevices=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices:navigator.mozGetUserMedia||navigator.webkitGetUserMedia?{getUserMedia:function(e){return new Promise(function(t,a){(navigator.mozGetUserMedia||navigator.webkitGetUserMedia).call(navigator,e,t,a)})}}:null;e.URL=e.URL||e.webkitURL||e.mozURL||e.msURL;this.userMedia=this.userMedia&&!!this.mediaDevices&&!!e.URL;if(navigator.userAgent.match(/Firefox\D+(\d+)/)){if(parseInt(RegExp.$1,10)<21)this.userMedia=null}if(this.userMedia){e.addEventListener("beforeunload",function(e){t.reset()})}},attach:function(a){if(typeof a=="string"){a=document.getElementById(a)||document.querySelector(a)}if(!a){return null}this.container=a;a.innerHTML="";var i=document.createElement("div");a.appendChild(i);this.peg=i;if(!this.params.width)this.params.width=a.offsetWidth;if(!this.params.height)this.params.height=a.offsetHeight;if(!this.params.width||!this.params.height){return this.dispatch("error",new s("No width and/or height for webcam.  Please call set() first, or attach to a visible element."))}if(!this.params.dest_width)this.params.dest_width=this.params.width;if(!this.params.dest_height)this.params.dest_height=this.params.height;this.userMedia=t===undefined?this.userMedia:t;if(this.params.force_flash){t=this.userMedia;this.userMedia=null}if(typeof this.params.fps!=="number")this.params.fps=30;var r=this.params.width/this.params.dest_width;var o=this.params.height/this.params.dest_height;if(this.userMedia){var n=document.createElement("video");n.setAttribute("autoplay","autoplay");n.style.width=""+this.params.dest_width+"px";n.style.height=""+this.params.dest_height+"px";if(r!=1||o!=1){a.style.overflow="hidden";n.style.webkitTransformOrigin="0px 0px";n.style.mozTransformOrigin="0px 0px";n.style.msTransformOrigin="0px 0px";n.style.oTransformOrigin="0px 0px";n.style.transformOrigin="0px 0px";n.style.webkitTransform="scaleX("+r+") scaleY("+o+")";n.style.mozTransform="scaleX("+r+") scaleY("+o+")";n.style.msTransform="scaleX("+r+") scaleY("+o+")";n.style.oTransform="scaleX("+r+") scaleY("+o+")";n.style.transform="scaleX("+r+") scaleY("+o+")"}a.appendChild(n);this.video=n;var h=this;this.mediaDevices.getUserMedia({audio:false,video:this.params.constraints||{mandatory:{minWidth:this.params.dest_width,minHeight:this.params.dest_height}}}).then(function(t){n.onloadedmetadata=function(e){h.stream=t;h.loaded=true;h.live=true;h.dispatch("load");h.dispatch("live");h.flip()};n.src=e.URL.createObjectURL(t)||t}).catch(function(e){if(h.params.enable_flash&&h.detectFlash()){setTimeout(function(){h.params.force_flash=1;h.attach(a)},1)}else{h.dispatch("error",e)}})}else if(this.params.enable_flash&&this.detectFlash()){e.Webcam=Webcam;var l=document.createElement("div");l.innerHTML=this.getSWFHTML();a.appendChild(l)}else{this.dispatch("error",new s(this.params.noInterfaceFoundText))}if(this.params.crop_width&&this.params.crop_height){var c=Math.floor(this.params.crop_width*r);var m=Math.floor(this.params.crop_height*o);a.style.width=""+c+"px";a.style.height=""+m+"px";a.style.overflow="hidden";a.scrollLeft=Math.floor(this.params.width/2-c/2);a.scrollTop=Math.floor(this.params.height/2-m/2)}else{a.style.width=""+this.params.width+"px";a.style.height=""+this.params.height+"px"}},reset:function(){if(this.preview_active)this.unfreeze();this.unflip();if(this.userMedia){if(this.stream){if(this.stream.getVideoTracks){var e=this.stream.getVideoTracks();if(e&&e[0]&&e[0].stop)e[0].stop()}else if(this.stream.stop){this.stream.stop()}}delete this.stream;delete this.video}if(this.userMedia!==true){var t=this.getMovie();if(t&&t._releaseCamera)t._releaseCamera()}if(this.container){this.container.innerHTML="";delete this.container}this.loaded=false;this.live=false},set:function(){if(arguments.length==1){for(var e in arguments[0]){this.params[e]=arguments[0][e]}}else{this.params[arguments[0]]=arguments[1]}},on:function(e,t){e=e.replace(/^on/i,"").toLowerCase();if(!this.hooks[e])this.hooks[e]=[];this.hooks[e].push(t)},off:function(e,t){e=e.replace(/^on/i,"").toLowerCase();if(this.hooks[e]){if(t){var a=this.hooks[e].indexOf(t);if(a>-1)this.hooks[e].splice(a,1)}else{this.hooks[e]=[]}}},dispatch:function(){var t=arguments[0].replace(/^on/i,"").toLowerCase();var i=Array.prototype.slice.call(arguments,1);if(this.hooks[t]&&this.hooks[t].length){for(var r=0,o=this.hooks[t].length;r<o;r++){var n=this.hooks[t][r];if(typeof n=="function"){n.apply(this,i)}else if(typeof n=="object"&&n.length==2){n[0][n[1]].apply(n[0],i)}else if(e[n]){e[n].apply(e,i)}}return true}else if(t=="error"){if(i[0]instanceof a||i[0]instanceof s){message=i[0].message}else{message="Could not access webcam: "+i[0].name+": "+i[0].message+" "+i[0].toString()}alert("Webcam.js Error: "+message)}return false},setSWFLocation:function(e){this.set("swfURL",e)},detectFlash:function(){var t="Shockwave Flash",a="ShockwaveFlash.ShockwaveFlash",s="application/x-shockwave-flash",i=e,r=navigator,o=false;if(typeof r.plugins!=="undefined"&&typeof r.plugins[t]==="object"){var n=r.plugins[t].description;if(n&&(typeof r.mimeTypes!=="undefined"&&r.mimeTypes[s]&&r.mimeTypes[s].enabledPlugin)){o=true}}else if(typeof i.ActiveXObject!=="undefined"){try{var h=new ActiveXObject(a);if(h){var l=h.GetVariable("$version");if(l)o=true}}catch(c){}}return o},getSWFHTML:function(){var t="",s=this.params.swfURL;if(location.protocol.match(/file/)){this.dispatch("error",new a("Flash does not work from local disk.  Please run from a web server."));return'<h3 style="color:red">ERROR: the Webcam.js Flash fallback does not work from local disk.  Please run it from a web server.</h3>'}if(!this.detectFlash()){this.dispatch("error",new a("Adobe Flash Player not found.  Please install from get.adobe.com/flashplayer and try again."));return'<h3 style="color:red">'+this.params.flashNotDetectedText+"</h3>"}if(!s){var i="";var r=document.getElementsByTagName("script");for(var o=0,n=r.length;o<n;o++){var h=r[o].getAttribute("src");if(h&&h.match(/\/webcam(\.min)?\.js/)){i=h.replace(/\/webcam(\.min)?\.js.*$/,"");o=n}}if(i)s=i+"/webcam.swf";else s="webcam.swf"}if(e.localStorage&&!localStorage.getItem("visited")){this.params.new_user=1;localStorage.setItem("visited",1)}var l="";for(var c in this.params){if(l)l+="&";l+=c+"="+escape(this.params[c])}t+='<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" type="application/x-shockwave-flash" codebase="'+this.protocol+'://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0" width="'+this.params.width+'" height="'+this.params.height+'" id="webcam_movie_obj" align="middle"><param name="wmode" value="opaque" /><param name="allowScriptAccess" value="always" /><param name="allowFullScreen" value="false" /><param name="movie" value="'+s+'" /><param name="loop" value="false" /><param name="menu" value="false" /><param name="quality" value="best" /><param name="bgcolor" value="#ffffff" /><param name="flashvars" value="'+l+'"/><embed id="webcam_movie_embed" src="'+s+'" wmode="opaque" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="'+this.params.width+'" height="'+this.params.height+'" name="webcam_movie_embed" align="middle" allowScriptAccess="always" allowFullScreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="'+l+'"></embed></object>';return t},getMovie:function(){if(!this.loaded)return this.dispatch("error",new a("Flash Movie is not loaded yet"));var e=document.getElementById("webcam_movie_obj");if(!e||!e._snap)e=document.getElementById("webcam_movie_embed");if(!e)this.dispatch("error",new a("Cannot locate Flash movie in DOM"));return e},freeze:function(){var e=this;var t=this.params;if(this.preview_active)this.unfreeze();var a=this.params.width/this.params.dest_width;var s=this.params.height/this.params.dest_height;this.unflip();var i=t.crop_width||t.dest_width;var r=t.crop_height||t.dest_height;var o=document.createElement("canvas");o.width=i;o.height=r;var n=o.getContext("2d");this.preview_canvas=o;this.preview_context=n;if(a!=1||s!=1){o.style.webkitTransformOrigin="0px 0px";o.style.mozTransformOrigin="0px 0px";o.style.msTransformOrigin="0px 0px";o.style.oTransformOrigin="0px 0px";o.style.transformOrigin="0px 0px";o.style.webkitTransform="scaleX("+a+") scaleY("+s+")";o.style.mozTransform="scaleX("+a+") scaleY("+s+")";o.style.msTransform="scaleX("+a+") scaleY("+s+")";o.style.oTransform="scaleX("+a+") scaleY("+s+")";o.style.transform="scaleX("+a+") scaleY("+s+")"}this.snap(function(){o.style.position="relative";o.style.left=""+e.container.scrollLeft+"px";o.style.top=""+e.container.scrollTop+"px";e.container.insertBefore(o,e.peg);e.container.style.overflow="hidden";e.preview_active=true},o)},unfreeze:function(){if(this.preview_active){this.container.removeChild(this.preview_canvas);delete this.preview_context;delete this.preview_canvas;this.preview_active=false;this.flip()}},flip:function(){if(this.params.flip_horiz){var e=this.container.style;e.webkitTransform="scaleX(-1)";e.mozTransform="scaleX(-1)";e.msTransform="scaleX(-1)";e.oTransform="scaleX(-1)";e.transform="scaleX(-1)";e.filter="FlipH";e.msFilter="FlipH"}},unflip:function(){if(this.params.flip_horiz){var e=this.container.style;e.webkitTransform="scaleX(1)";e.mozTransform="scaleX(1)";e.msTransform="scaleX(1)";e.oTransform="scaleX(1)";e.transform="scaleX(1)";e.filter="";e.msFilter=""}},savePreview:function(e,t){var a=this.params;var s=this.preview_canvas;var i=this.preview_context;if(t){var r=t.getContext("2d");r.drawImage(s,0,0)}e(t?null:s.toDataURL("image/"+a.image_format,a.jpeg_quality/100),s,i);if(this.params.unfreeze_snap)this.unfreeze()},snap:function(e,t){var a=this;var i=this.params;if(!this.loaded)return this.dispatch("error",new s("Webcam is not loaded yet"));if(!e)return this.dispatch("error",new s("Please provide a callback function or canvas to snap()"));if(this.preview_active){this.savePreview(e,t);return null}var r=document.createElement("canvas");r.width=this.params.dest_width;r.height=this.params.dest_height;var o=r.getContext("2d");if(this.params.flip_horiz){o.translate(i.dest_width,0);o.scale(-1,1)}var n=function(){if(this.src&&this.width&&this.height){o.drawImage(this,0,0,i.dest_width,i.dest_height)}if(i.crop_width&&i.crop_height){var a=document.createElement("canvas");a.width=i.crop_width;a.height=i.crop_height;var s=a.getContext("2d");s.drawImage(r,Math.floor(i.dest_width/2-i.crop_width/2),Math.floor(i.dest_height/2-i.crop_height/2),i.crop_width,i.crop_height,0,0,i.crop_width,i.crop_height);o=s;r=a}if(t){var n=t.getContext("2d");n.drawImage(r,0,0)}e(t?null:r.toDataURL("image/"+i.image_format,i.jpeg_quality/100),r,o)};if(this.userMedia){o.drawImage(this.video,0,0,this.params.dest_width,this.params.dest_height);n()}else{var h=this.getMovie()._snap();var l=new Image;l.onload=n;l.src="data:image/"+this.params.image_format+";base64,"+h}return null},configure:function(e){if(!e)e="camera";this.getMovie()._configure(e)},flashNotify:function(e,t){switch(e){case"flashLoadComplete":this.loaded=true;this.dispatch("load");break;case"cameraLive":this.live=true;this.dispatch("live");break;case"error":this.dispatch("error",new a(t));break;default:break}},b64ToUint6:function(e){return e>64&&e<91?e-65:e>96&&e<123?e-71:e>47&&e<58?e+4:e===43?62:e===47?63:0},base64DecToArr:function(e,t){var a=e.replace(/[^A-Za-z0-9\+\/]/g,""),s=a.length,i=t?Math.ceil((s*3+1>>2)/t)*t:s*3+1>>2,r=new Uint8Array(i);for(var o,n,h=0,l=0,c=0;c<s;c++){n=c&3;h|=this.b64ToUint6(a.charCodeAt(c))<<18-6*n;if(n===3||s-c===1){for(o=0;o<3&&l<i;o++,l++){r[l]=h>>>(16>>>o&24)&255}h=0}}return r},upload:function(e,t,a){var s=this.params.upload_name||"webcam";var i="";if(e.match(/^data\:image\/(\w+)/))i=RegExp.$1;else throw"Cannot locate image format in Data URI";var r=e.replace(/^data\:image\/\w+\;base64\,/,"");var o=new XMLHttpRequest;o.open("POST",t,true);if(o.upload&&o.upload.addEventListener){o.upload.addEventListener("progress",function(e){if(e.lengthComputable){var t=e.loaded/e.total;Webcam.dispatch("uploadProgress",t,e)}},false)}var n=this;o.onload=function(){if(a)a.apply(n,[o.status,o.responseText,o.statusText]);Webcam.dispatch("uploadComplete",o.status,o.responseText,o.statusText)};var h=new Blob([this.base64DecToArr(r)],{type:"image/"+i});var l=new FormData;l.append(s,h,s+"."+i.replace(/e/,""));o.send(l)}};Webcam.init();if(typeof define==="function"&&define.amd){define(function(){return Webcam})}else if(typeof module==="object"&&module.exports){module.exports=Webcam}else{e.Webcam=Webcam}})(window);
});